(this.webpackJsonpdemo=this.webpackJsonpdemo||[]).push([[0],{163:function(e,t,i){e.exports=i(292)},168:function(e,t,i){},170:function(e,t,i){},292:function(e,t,i){"use strict";i.r(t);var a=i(0),n=i.n(a),o=i(30),r=i.n(o),s=(i(168),i(44)),c=i.n(s),h=i(85),l=i(131),d=i(132),v=i(153),u=i(151),f=(i(170),i(300)),g=i(152),m=.2,p=300,w=300,y="/WEB_MODEL/300x300_0.10/model.json",S={QVGA:{facingMode:"environment",width:{exact:320},height:{exact:240}},VGA:{facingMode:"environment",width:{exact:640},height:{exact:480}},HD:{facingMode:"environment",width:{exact:1280},height:{exact:720}},FULLHD:{facingMode:"environment",width:{exact:1920},height:{exact:1080}},FourK:{facingMode:"environment",width:{ideal:2500,max:4096},height:{ideal:1600,max:4096}},EightK:{facingMode:"environment",width:{ideal:7680},height:{ideal:4320}}},R={VGA:S.VGA,HD:S.HD,FULLHD:S.FULLHD};var k=function(e){var t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t},C=i(133),b=function(e){Object(v.a)(i,e);var t=Object(u.a)(i);function i(){var e;Object(l.a)(this,i);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={count:0,videoResolution:"VGA",colnum:1,rownum:1,showRect:!0,showSS:!1,showGrid:!1,initialized:!1},e.parentRef=n.a.createRef(),e.videoRef=n.a.createRef(),e.controllerCanvasRef=n.a.createRef(),e.controllerDivRef=n.a.createRef(),e.workerSSMaskMonitorCanvasRef=n.a.createRef(),e.videoHeight=0,e.videoWidth=0,e.parentHeight=0,e.parentWidth=0,e.overlayWidth=0,e.overlayHeight=0,e.overlayXOffset=0,e.overlayYOffset=0,e.scalableSS=new C.ScalableSemanticSegmentation,e.changeCameraResolution=function(t){if(e.videoRef.current.srcObject.getTracks().map((function(e){return e.stop()})),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var i=navigator.mediaDevices.getUserMedia({audio:!1,video:R[t]}).then((function(t){return console.log(e.videoRef),e.videoRef.current.srcObject=t,new Promise((function(t,i){e.videoRef.current.onloadedmetadata=function(){t()}}))}));Promise.all([i]).then((function(i){console.log("Camera and model ready!");var a=e.videoRef.current;e.checkParentSizeChanged(a),e.setState({videoResolution:t})})).catch((function(e){console.error(e)}))}},e.requestScanBarcode=Object(h.a)(c.a.mark((function t(){var i,a,n;return c.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("requestScanBarcode"),i=e.videoRef.current,(a=e.controllerCanvasRef.current).width=e.overlayWidth,a.height=e.overlayHeight,0!==(n=k(i)).width){t.next=10;break}return n.remove(),window.requestAnimationFrame(e.requestScanBarcode),t.abrupt("return");case 10:e.scalableSS.predict(n,e.state.colnum,e.state.rownum),n.remove();case 12:case"end":return t.stop()}}),t)}))),e}return Object(d.a)(i,[{key:"initWorker",value:function(){var e=Object(h.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scalableSS.addInitializedListener((function(){t.props;t.setState({initialized:!0}),t.requestScanBarcode()})),this.scalableSS.addMaskPredictedListeners((function(e){t.requestScanBarcode()})),this.scalableSS.init(y,p,w,m),e.abrupt("return");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkParentSizeChanged",value:function(e){this.videoHeight=e.videoHeight,this.videoWidth=e.videoWidth;var t=(e.getBoundingClientRect().bottom,e.getBoundingClientRect().top),i=e.getBoundingClientRect().right-e.getBoundingClientRect().left;t=i/this.videoWidth*this.videoHeight,this.parentHeight=t,this.parentWidth=i;var a=function(e,t,i,a){var n=0,o=0,r=0,s=0;return e/t>i/a?(s=0,r=(e-(o=(n=t)*(i/a)))/2):(r=0,s=(t-(n=(o=e)*(a/i)))/2),{overlayWidth:o=Math.floor(o),overlayHeight:n=Math.floor(n),overlayXOffset:r=Math.floor(r),overlayYOffset:s=Math.floor(s)}}(this.parentWidth,this.parentHeight,this.videoWidth,this.videoHeight),n=a.overlayWidth,o=a.overlayHeight,r=a.overlayXOffset,s=a.overlayYOffset;this.overlayWidth=n,this.overlayHeight=o,this.overlayXOffset=r,this.overlayYOffset=s,this.workerSSMaskMonitorCanvasRef.current.width=this.overlayWidth,this.workerSSMaskMonitorCanvasRef.current.height=this.overlayHeight,this.controllerCanvasRef.current.width=this.overlayWidth,this.controllerCanvasRef.current.height=this.overlayHeight}},{key:"componentDidMount",value:function(){var e=this;console.log("Initializing");var t=this.initWorker();if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var i=navigator.mediaDevices.getUserMedia({audio:!1,video:R[this.state.videoResolution]}).then((function(t){return console.log(e.videoRef),e.videoRef.current.srcObject=t,new Promise((function(t,i){e.videoRef.current.onloadedmetadata=function(){t()}}))}));Promise.all([t,i]).then((function(e){console.log("Camera and model ready!")})).catch((function(e){console.error(e)}))}}},{key:"render",value:function(){var e=this,t=this.videoRef.current;!0===this.state.initialized&&(console.log("initialized"),this.checkParentSizeChanged(t));var i=Object.keys(R).map((function(e){return{key:e,text:e,value:e}})),a=[1,2,3].map((function(e){return{key:e,text:e,value:e}})),o=[1,2,3].map((function(e){return{key:e,text:e,value:e}}));return n.a.createElement("div",{style:{width:"100%",height:this.parentHeight,position:"relative",top:0,left:0},ref:this.parentRef},n.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:this.videoRef,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0}}),n.a.createElement("canvas",{ref:this.workerSSMaskMonitorCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("canvas",{ref:this.controllerCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("div",{ref:this.controllerDivRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}},n.a.createElement(f.a,{text:"Resolution",options:i,simple:!0,item:!0,onChange:function(t,i){var a=i.value;e.changeCameraResolution(a)}}),n.a.createElement(f.a,{text:"col",options:a,simple:!0,item:!0,onChange:function(t,i){var a=i.value;e.setState({colnum:a})}}),n.a.createElement(f.a,{text:"row",options:o,simple:!0,item:!0,onChange:function(t,i){var a=i.value;e.setState({rownum:a})}}),n.a.createElement(g.a,{basic:!0,size:"tiny",color:this.state.showSS?"red":"grey",onClick:function(){var t=!e.state.showSS;e.scalableSS.previewCanvas=t?e.workerSSMaskMonitorCanvasRef.current:null,e.setState({showSS:t})}},"ss"),n.a.createElement(g.a,{basic:!0,size:"tiny",color:this.state.showGrid?"red":"grey",onClick:function(){var t=!e.state.showGrid;e.scalableSS.girdDrawCanvas=t?e.controllerCanvasRef.current:null,e.setState({showGrid:!e.state.showGrid})}},"grid")))}}]),i}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[163,1,2]]]);
//# sourceMappingURL=main.e306d0d3.chunk.js.map