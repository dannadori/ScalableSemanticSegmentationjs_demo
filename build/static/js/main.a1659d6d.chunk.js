(this.webpackJsonpdemo=this.webpackJsonpdemo||[]).push([[0],{163:function(e,t,a){e.exports=a(292)},168:function(e,t,a){},170:function(e,t,a){},292:function(e,t,a){"use strict";a.r(t);var i=a(0),n=a.n(i),r=a(30),o=a.n(r),s=(a(168),a(44)),h=a.n(s),c=a(85),l=a(131),f=a(132),d=a(153),v=a(151),u=(a(170),a(300)),g=a(152),m=.2,p=300,w=300,y="/WEB_MODEL/300x300_0.10/model.json",R={QVGA:{facingMode:"environment",width:{exact:320},height:{exact:240}},VGA:{facingMode:"environment",width:{exact:640},height:{exact:480}},HD:{facingMode:"environment",width:{exact:1280},height:{exact:720}},FULLHD:{facingMode:"environment",width:{exact:1920},height:{exact:1080}},FourK:{facingMode:"environment",width:{ideal:2500,max:4096},height:{ideal:1600,max:4096}},EightK:{facingMode:"environment",width:{ideal:7680},height:{ideal:4320}}},S={VGA:R.VGA,HD:R.HD,FULLHD:R.FULLHD};var C=function(e){var t=document.createElement("canvas");return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t},k=a(133),b=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(){var e;Object(l.a)(this,a);for(var i=arguments.length,r=new Array(i),o=0;o<i;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={count:0,videoResolution:"VGA",colnum:1,rownum:1,showRect:!0,showSS:!1,showGrid:!1,initialized:!1},e.parentRef=n.a.createRef(),e.imageRef1=n.a.createRef(),e.imageRef2=n.a.createRef(),e.videoRef=n.a.createRef(),e.barcodeDisplayCanvasRef=n.a.createRef(),e.controllerCanvasRef=n.a.createRef(),e.statusCanvasRef=n.a.createRef(),e.controllerDivRef=n.a.createRef(),e.workerSSMaskMonitorCanvasRef=n.a.createRef(),e.workerAreaCVCanvasRef=n.a.createRef(),e.videoHeight=0,e.videoWidth=0,e.parentHeight=0,e.parentWidth=0,e.overlayWidth=0,e.overlayHeight=0,e.overlayXOffset=0,e.overlayYOffset=0,e.scalableSS=new k.ScalableSemanticSegmentation,e.video_img=null,e.working_video_img=null,e.frame=0,e.fps=0,e.frameCountStartTime=(new Date).getTime(),e.changeCameraResolution=function(t){if(e.videoRef.current.srcObject.getTracks().map((function(e){return e.stop()})),navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia({audio:!1,video:S[t]}).then((function(t){return console.log(e.videoRef),e.videoRef.current.srcObject=t,new Promise((function(t,a){e.videoRef.current.onloadedmetadata=function(){t()}}))}));Promise.all([a]).then((function(a){console.log("Camera and model ready!");var i=e.videoRef.current;e.checkParentSizeChanged(i),e.setState({videoResolution:t})})).catch((function(e){console.error(e)}))}},e.requestScanBarcode=Object(c.a)(h.a.mark((function t(){var a,i,n;return h.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("requestScanBarcode"),a=e.videoRef.current,(i=e.controllerCanvasRef.current).width=e.overlayWidth,i.height=e.overlayHeight,0!==(n=C(a)).width){t.next=10;break}return n.remove(),window.requestAnimationFrame(e.requestScanBarcode),t.abrupt("return");case 10:e.scalableSS.predict(n,e.state.colnum,e.state.rownum,m),e.video_img=n.getContext("2d").getImageData(0,0,n.width,n.height),n.remove();case 13:case"end":return t.stop()}}),t)}))),e}return Object(f.a)(a,[{key:"gameLoop",value:function(){this.frame++;var e=(new Date).getTime();if(e-this.frameCountStartTime>1e3){var t=this.frame/(e-this.frameCountStartTime)*1e3;this.frameCountStartTime=(new Date).getTime(),this.frame=0,this.fps=t}}},{key:"initWorker",value:function(){var e=Object(c.a)(h.a.mark((function e(){var t=this;return h.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.scalableSS.addInitializedListener((function(){t.props;t.setState({initialized:!0}),t.requestScanBarcode()})),this.scalableSS.addMaskPredictedListeners((function(e){t.working_video_img=t.video_img,t.requestScanBarcode()})),this.scalableSS.init(y,p,w,m),e.abrupt("return");case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkParentSizeChanged",value:function(e){this.videoHeight=e.videoHeight,this.videoWidth=e.videoWidth;var t=(e.getBoundingClientRect().bottom,e.getBoundingClientRect().top),a=e.getBoundingClientRect().right-e.getBoundingClientRect().left;t=a/this.videoWidth*this.videoHeight,this.parentHeight=t,this.parentWidth=a;var i=function(e,t,a,i){var n=0,r=0,o=0,s=0;return e/t>a/i?(s=0,o=(e-(r=(n=t)*(a/i)))/2):(o=0,s=(t-(n=(r=e)*(i/a)))/2),{overlayWidth:r=Math.floor(r),overlayHeight:n=Math.floor(n),overlayXOffset:o=Math.floor(o),overlayYOffset:s=Math.floor(s)}}(this.parentWidth,this.parentHeight,this.videoWidth,this.videoHeight),n=i.overlayWidth,r=i.overlayHeight,o=i.overlayXOffset,s=i.overlayYOffset;this.overlayWidth=n,this.overlayHeight=r,this.overlayXOffset=o,this.overlayYOffset=s,this.workerAreaCVCanvasRef.current.width=this.overlayWidth,this.workerAreaCVCanvasRef.current.height=this.overlayHeight,this.workerSSMaskMonitorCanvasRef.current.width=this.overlayWidth,this.workerSSMaskMonitorCanvasRef.current.height=this.overlayHeight,this.controllerCanvasRef.current.width=this.overlayWidth,this.controllerCanvasRef.current.height=this.overlayHeight}},{key:"componentDidMount",value:function(){var e=this;console.log("Initializing");var t=this.initWorker();if(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia){var a=navigator.mediaDevices.getUserMedia({audio:!1,video:S[this.state.videoResolution]}).then((function(t){return console.log(e.videoRef),e.videoRef.current.srcObject=t,new Promise((function(t,a){e.videoRef.current.onloadedmetadata=function(){t()}}))}));Promise.all([t,a]).then((function(e){console.log("Camera and model ready!")})).catch((function(e){console.error(e)}))}}},{key:"render",value:function(){var e=this,t=this.videoRef.current;!0===this.state.initialized&&(console.log("initialized"),this.checkParentSizeChanged(t));var a=Object.keys(S).map((function(e){return{key:e,text:e,value:e}})),i=[1,2,3].map((function(e){return{key:e,text:e,value:e}})),r=[1,2,3].map((function(e){return{key:e,text:e,value:e}}));return n.a.createElement("div",{style:{width:"100%",height:this.parentHeight,position:"relative",top:0,left:0},ref:this.parentRef},n.a.createElement("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:this.videoRef,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0}}),n.a.createElement("canvas",{ref:this.workerSSMaskMonitorCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("canvas",{ref:this.workerAreaCVCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("canvas",{ref:this.barcodeDisplayCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("canvas",{ref:this.controllerCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("canvas",{ref:this.statusCanvasRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}}),n.a.createElement("div",{ref:this.controllerDivRef,style:{position:"absolute",top:this.overlayYOffset,left:this.overlayXOffset,width:this.parentWidth,height:this.parentHeight}},n.a.createElement(u.a,{text:"Resolution",options:a,simple:!0,item:!0,onChange:function(t,a){var i=a.value;e.changeCameraResolution(i)}}),n.a.createElement(u.a,{text:"col",options:i,simple:!0,item:!0,onChange:function(t,a){var i=a.value;e.setState({colnum:i})}}),n.a.createElement(u.a,{text:"row",options:r,simple:!0,item:!0,onChange:function(t,a){var i=a.value;e.setState({rownum:i})}}),n.a.createElement(g.a,{basic:!0,size:"tiny",color:this.state.showSS?"red":"grey",onClick:function(){var t=!e.state.showSS;e.scalableSS.previewCanvas=t?e.workerSSMaskMonitorCanvasRef.current:null,e.setState({showSS:t})}},"ss"),n.a.createElement(g.a,{basic:!0,size:"tiny",color:this.state.showGrid?"red":"grey",onClick:function(){var t=!e.state.showGrid;e.scalableSS.girdDrawCanvas=t?e.controllerCanvasRef.current:null,e.setState({showGrid:!e.state.showGrid})}},"grid")))}}]),a}(n.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(b,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[163,1,2]]]);
//# sourceMappingURL=main.a1659d6d.chunk.js.map